extends layout

block meta
	meta(name="viewport", content="width=528, user-scalable=no")
	
block javascript
	// script(src="https://getfirebug.com/firebug-lite.js#enableTrace")

	script(src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js")
	script(src="http://cdn.sockjs.org/sockjs-0.3.min.js")
	script(src="http://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.2.1/lodash.js")
	
	script(src="http://code.createjs.com/createjs-2013.12.12.min.js")
	
	script(src="../client/Loader.js")
	script(src="../client/ColorSubstitutionFilter.js")
	script(src="../client/ColorMatrix.js")
	script(src="../client/ColorMatrixFilter.js")
	script(src="../client/tweakDOMElement.js")
	script(src="../client/config.js")
	// addons.js may change to be generated by server rather than a static file:
	script(src="../client/addons.js")
	script(src="../client/Avatar.js")
	script(src="../client/AvatarAssets.js")
	script(src="../client/AddonsList.js")
	script(src="../client/DressingRoom.js")
	script(src="../client/Homeroom.js")
	script(src="../client/HomeroomGameListing.js")
	script(src="../client/GameRoom.js")
	script(src="../client/GameRoomPlayer.js")
	script(src="../client/GameRoomConsole.js")
	script(src="../client/GameActionMenu.js")
	script(src="../client/GameRoomResultsDisplay.js")
	script(src="../client/Sound.js")
	script(src="../client/Comm.js")
	script(src="../client/Main.js")
	
	script(type='text/javascript').
		var token = '#{token}';
		var session = '#{session}';
		var school = '#{school}';
		
		// big global variable for remembering stuff 
		var g = {load:{}, dressing:{}, homeroom:{}, game:{}};
		
		g.gameScale = '#{gameScale}' || 1;
		
		// sissyfight namespace
		this.sf = this.sf||{};
				

		sf.start = function(SockJS, auth, school) {
			var appCanvas = document.getElementById('appCanvas');
		
			// disable browser drag-and-drop on game canvas 
			//		http://developer.nokia.com/Community/Wiki/How_to_disable_dragging_of_images_and_text_selection_in_web_pages
			//		http://stackoverflow.com/questions/704564/disable-drag-and-drop-on-html-elements
			appCanvas.draggable = false;
			appCanvas.onmousedown = function(event) {
				if (event.preventDefault) event.preventDefault();
				return false;
			}
			
			if (g.gameScale==1) {
				appCanvas.className = 'singleCanvas';
			}
			else if (g.gameScale==2) {
				appCanvas.className = 'doubleCanvas';
			}
			
			
			var stage = new createjs.Stage("appCanvas");
			createjs.Touch.enable(stage);
			var main = new sf.Main();
			stage.addChild(main);
			main.start(SockJS, auth, school);
		}
		
		// prevent accidentally leaving game by hitting backspace
		// http://stackoverflow.com/a/19394745
		$(document).on("keydown", function (e) {
			if (e.which === 8 && !$(e.target).is("input[type='text']:not([readonly]), textarea")) {
				e.preventDefault();
			}
		});


		
block content
	table
		tr
			td: form(method='post',action='/user/logout')
					input(type='submit', value='log out')
			td: form(method='get',action='/game')
					input(type='submit', value='reload')
			td	
				a(HREF="https://docs.google.com/forms/d/1lLWMiJlPY2hu5SJhrNUeacD--9F_wtsIEHiddGl18UQ/viewform", target='_blank')
					please click here to fill out a bug report
					
			
	script(type='text/javascript').
		window.onload = function() {
			sf.start(SockJS, {token:token, session:session, endpoint:'/sox'}, school);
		}
		
			
		
	style.
		/*	attempt to scale up canvas while preserving pixels - 
			fails to prevent blurring on firefox and chrome, but works on safari and ios 5 and 6 browser 
			https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering
		*/
		#appCanvas {   
			image-rendering:-webkit-optimize-contrast; 
			image-rendering:pixelated;  
			image-rendering:moz-crisp-edges; 
			image-rendering:-o-crisp-edges;    
			-ms-interpolation-mode: nearest-neighbor;
			
			image-rendering:optimizeSpeed;              /* Legal fallback                 */
			image-rendering:-moz-crisp-edges;           /* Firefox                        */
			image-rendering:crisp-edges;                /* CSS3 Proposed                  */
			}
		.doubleCanvas {
			width: 1056px;    
			height: 552px;  
		}
		.singleCanvas {
			width: 528;
			height: 276;
		}
		#container {
			position: relative;
		}
		
		.disableSelect {
			-webkit-user-select: none;  
			-moz-user-select: none;    
			-ms-user-select: none;      
			user-select: none;
		}

		.homeroomText  {
			font-family: Arial, Helvetica, sans-serif;
			font-size: 11px;
			
			resize: none;
			visibility: hidden;
			
			overflow: hidden;
			
			border: none;
		}
		
		.gameroomText {			
			font-family: Arial, Helvetica, sans-serif;
			
			resize: none;
			visibility: hidden;
			
			overflow: hidden;
			
			border: none;
		}
		
		.gameroomChatNormal {
			line-height: 12px;
			font-size: 11px;
			font-weight: normal;
		}
		
		.gameroomChatBig {
			line-height: 20px;
			font-size: 18px;
			font-weight: 550;		
		}
		
		.captionText {
			font-family: Arial, Helvetica, sans-serif;
			font-size: 11px;
			line-height: 12px;
			text-align: center;
			
			resize: none;
			visibility: hidden;
			
			overflow: hidden;
			
			border: none;	
		}
		
		.wordwrap { // http://stackoverflow.com/a/1638824
			white-space: pre-wrap;      /* CSS3 */   
			white-space: -moz-pre-wrap; /* Firefox */    
			white-space: -pre-wrap;     /* Opera <7 */   
			white-space: -o-pre-wrap;   /* Opera 7 */    
			word-wrap: break-word;      /* IE */
		}

		
		
	div#container(width=528,height=276)
		canvas#appCanvas.singleCanvas(width=528,height=276)
		
		div.homeroomText.disableSelect.wordwrap#homeroomChat(width=120, height=150, unselectable="yes")
		textarea.homeroomText#homeroomTextEntry(width=79, height=43)
		
		textarea.gameroomText.gameroomChatNormal#gameroomTextEntry(width=79, height=43)
		each i in [0,1,2,3,4,5]
			div.gameroomText.gameroomChatNormal.disableSelect.wordwrap(id='gameroomChatBubble'+i)
			
		div.captionText.disableSelect.wordwrap#gameroomCaption(unselectable="yes")
		
		input.homeroomText#homeroomCreateGameEntry(type='text', width=83, height=12, maxlength=12)
		


	div#notOnTablet
		p <B>Remember: this is a beta!</B> You'll probably discover that some things aren't working yet, or at least not how you'd expect them to. There are many features from classic SiSSYFiGHT, as well as new additions, that we haven't developed yet. These include the ability to create your own game rooms -- so for now, please play in one of the pre-made game rooms.
	
		p <B>Send us your bug reports.</B> If you do notice something strange or broken about how the game's working, <A HREF="https://docs.google.com/forms/d/1lLWMiJlPY2hu5SJhrNUeacD--9F_wtsIEHiddGl18UQ/viewform" target='_blank'>please click here to fill out a bug report,</A> and be sure to include details about your browser and system. That information will help us track the problems down and bring SiSSYFiGHT closer to completion!
	
		p <B>If you haven't played before,</B> take a look at <A HREF="http://halfrobot.com/sissyfight/testhelp.html" target='_blank'>our help page.</A> There's a guide at the top to help you get started!
		
		p Here are some things that are planned but not done yet - you don't have to file bug reports about them:
	
		ul
			li Game: Boot menu to kick out troublemakers
			li Music and sound (and the mute button to turn off the sound)
			li Contextual help text
			li Scoring and leaderboards
			li More custom outfits
		
		
		
	