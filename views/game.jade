extends layout

block javascript
	// script(src="https://getfirebug.com/firebug-lite.js#enableTrace")

	script(src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js")
	script(src="http://cdn.sockjs.org/sockjs-0.3.min.js")
	script(src="http://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.2.1/lodash.js")
	
	script(src="http://code.createjs.com/createjs-2013.09.25.min.js")
	
	script(src="../client/Loader.js")
	script(src="../client/ColorSubstitutionFilter.js")
	script(src="../client/ColorMatrix.js")
	script(src="../client/ColorMatrixFilter.js")
	script(src="../client/tweakDOMElement.js")
	script(src="../client/config.js")
	// addons.js may change to be generated by server rather than a static file:
	script(src="../client/addons.js")
	script(src="../client/Avatar.js")
	script(src="../client/AvatarAssets.js")
	script(src="../client/AddonsList.js")
	script(src="../client/DressingRoom.js")
	script(src="../client/Homeroom.js")
	script(src="../client/HomeroomGameListing.js")
	script(src="../client/GameRoom.js")
	script(src="../client/GameRoomPlayer.js")
	script(src="../client/GameRoomConsole.js")
	script(src="../client/GameActionMenu.js")
	script(src="../client/GameRoomResultsDisplay.js")
	script(src="../client/Comm.js")
	script(src="../client/Main.js")
	
	script(type='text/javascript').
		var token = '#{token}';
		var session = '#{session}';
		var school = '#{school}';
		
		// big global variable for remembering stuff 
		var g = {load:{}, dressing:{}, homeroom:{}, game:{}};
		
		g.gameScale = '#{gameScale}' || 1;
		
		// sissyfight namespace
		this.sf = this.sf||{};
				

		sf.start = function(SockJS, auth, school) {
			var appCanvas = document.getElementById('appCanvas');
		
			// disable browser drag-and-drop on game canvas 
			//		http://developer.nokia.com/Community/Wiki/How_to_disable_dragging_of_images_and_text_selection_in_web_pages
			//		http://stackoverflow.com/questions/704564/disable-drag-and-drop-on-html-elements
			appCanvas.draggable = false;
			appCanvas.onmousedown = function(event) {
				if (event.preventDefault) event.preventDefault();
				return false;
			}
			
			if (g.gameScale==1) {
				appCanvas.className = 'singleCanvas';
			}
			else if (g.gameScale==2) {
				appCanvas.className = 'doubleCanvas';
			}
			
			
			var stage = new createjs.Stage("appCanvas");
			var main = new sf.Main();
			stage.addChild(main);
			main.start(SockJS, auth, school);
		}


		
block content
	h1 SiSSYFiGHT 2000&frac12;
	
	table
		tr
			td: form(method='post',action='/user/logout')
					input(type='submit', value='log out')
			td: form(method='get',action='/game')
					input(type='submit', value='reload')
			td	
				a(href='http://sf2k.moonmilk.com/sissyfight/help.html', target='_blank')
					p Click here for gameplay instructions (username playtest, password tattletale)
			
	script(type='text/javascript').
		window.onload = function() {
			sf.start(SockJS, {token:token, session:session, endpoint:'/sox'}, school);
		}
		
			
		
	style.
		/*	attempt to scale up canvas while preserving pixels - 
			fails to prevent blurring on firefox and chrome, but works on safari and ios 5 and 6 browser 
			https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering
		*/
		#appCanvas {   
			image-rendering:-webkit-optimize-contrast; 
			image-rendering:pixelated;  
			image-rendering:moz-crisp-edges; 
			image-rendering:-o-crisp-edges;    
			-ms-interpolation-mode: nearest-neighbor;
			
			image-rendering:optimizeSpeed;              /* Legal fallback                 */
			image-rendering:-moz-crisp-edges;           /* Firefox                        */
			image-rendering:crisp-edges;                /* CSS3 Proposed                  */
			}
		.doubleCanvas {
			width: 1056px;    
			height: 552px;  
		}
		.singleCanvas {
			width: 528;
			height: 276;
		}
		#container {
			position: relative;
		}
		
		.disableSelect {
			-webkit-user-select: none;  
			-moz-user-select: none;    
			-ms-user-select: none;      
			user-select: none;
		}

		.homeroomText  {
			font-family: Arial, Helvetica, sans-serif;
			font-size: 12px;
			
			resize: none;
			visibility: hidden;
			
			overflow: hidden;
			
			border: none;
		}
		
		.gameroomText {
			font-family: Arial, Helvetica, sans-serif;
			font-size: 12px;
			
			resize: none;
			visibility: hidden;
			
			overflow: hidden;
			
			border: none;
		}
		
		.captionText {
			font-family: Arial, Helvetica, sans-serif;
			font-size: 11px;
			line-height: 12px;
			text-align: center;
			
			resize: none;
			visibility: hidden;
			
			overflow: hidden;
			
			border: none;	
		}
		
		.wordwrap { // http://stackoverflow.com/a/1638824
			white-space: pre-wrap;      /* CSS3 */   
			white-space: -moz-pre-wrap; /* Firefox */    
			white-space: -pre-wrap;     /* Opera <7 */   
			white-space: -o-pre-wrap;   /* Opera 7 */    
			word-wrap: break-word;      /* IE */
		}

		
		
	div#container(width=528,height=276)
		canvas#appCanvas.singleCanvas(width=528,height=276)
		
		div.homeroomText.disableSelect.wordwrap#homeroomChat(width=120, height=150, unselectable="yes")
		textarea.homeroomText#homeroomTextEntry(width=79, height=43)
		
		textarea.gameroomText#gameroomTextEntry(width=79, height=43)
		each i in [0,1,2,3,4,5]
			div.gameroomText.disableSelect.wordwrap(id='gameroomChatBubble'+i)
			
		div.captionText.disableSelect.wordwrap#gameroomCaption(unselectable="yes")
		
	